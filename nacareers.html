<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Careers | ChargePower Inc</title>
    <link rel="icon" type="image/svg+xml" href="Assets/Logo/CP_Icon.svg">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        // Initialize EmailJS
        (function() {
            emailjs.init("gTr382A7UknjukQq4"); // Replace with your EmailJS public key
        })();
    </script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="index.html">
                    <img src="Assets/Logo/CP_Master_V3-dark.svg" alt="Chargepower Logo" class="cp-logo" />
                </a>
                <span class="region-label">- North America</span>
            </div>
            <div class="nav-menu">
                <a href="nahome.html" class="nav-link">Home</a>
                <a href="naprojects.html" class="nav-link">Projects</a>
                <a href="naabout.html" class="nav-link">About</a>
                <a href="nablog.html" class="nav-link">Blog</a>
                <a href="nacareers.html" class="nav-link active">Careers</a>
                <a href="naContact.html" class="nav-link">Contact</a>
            </div>
            <div class="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="contact-hero" style="background: radial-gradient(circle at 30% 20%, rgba(22, 41, 244, 0.1) 0%, transparent 50%), radial-gradient(circle at 70% 80%, rgba(4, 254, 1, 0.1) 0%, transparent 50%);">
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title">Join Our Team</h1>
                <p class="hero-subtitle">Build the future of energy storage with us. Explore exciting career opportunities at Charge Power.</p>
            </div>
        </div>
    </section>

    <!-- Job Listings Section -->
    <section class="news-section" style="padding-top: 40px; padding-bottom: 40px;">
        <div class="container">
            <!-- Job Filters -->
            <div class="projects-filters" id="jobFilters" style="margin-bottom:2.5rem;">
                <button class="filter-btn active" data-filter="all">All Positions</button>
                <button class="filter-btn" data-filter="engineering">Engineering</button>
                <button class="filter-btn" data-filter="operations">Operations</button>
                <button class="filter-btn" data-filter="sales">Sales & Business</button>
                <button class="filter-btn" data-filter="internship">Internships</button>
            </div>
            <div class="projects-grid" id="jobsGrid">
                <!-- Job listings will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <!-- Social icons hidden as requested -->
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Charge Power Inc. All rights reserved.</p>
                <p>Designed & Developed by <a href="http://www.ardnepu.com" target="_blank" rel="noopener noreferrer" style="background: linear-gradient(90deg, #1e90ff 0%, #00c3ff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-decoration: none;">ardnepu</a></p>
            </div>
        </div>
    </footer>

    <!-- Job Modal -->
    <div id="jobModal" class="modal" style="display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); justify-content: center; align-items: center;">
        <div id="modalContent" style="background: var(--card-bg); border-radius: 12px; padding: 2rem; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; position: relative;">
            <!-- Modal content will be inserted here -->
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Load job listings from Supabase
        async function loadJobListings() {
            try {
                console.log('Loading job listings...');
                const { data: jobs, error } = await supabase
                    .from('jobs')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                console.log('Jobs data:', jobs);
                console.log('Jobs error:', error);
                
                if (error) {
                    console.error('Error loading jobs:', error);
                    return;
                }
                
                const jobsContainer = document.querySelector('.projects-grid');
                jobsContainer.innerHTML = '';
                
                if (!jobs || jobs.length === 0) {
                    console.log('No jobs found in database');
                    jobsContainer.innerHTML = '<p style="text-align:center;color:var(--text-secondary);padding:2rem;">No job openings at the moment. Please check back later!</p>';
                    return;
                }
                
                // Create all job elements at once
                const jobElements = jobs.map((job, index) => {
                    const jobElement = document.createElement('div');
                    jobElement.className = 'project-card job-post';
                    jobElement.setAttribute('data-job', index);
                    jobElement.setAttribute('data-type', job.department);
                    jobElement.innerHTML = `
                        <div class="project-header" style="margin-bottom:0;">
                            <div>
                                <h3 style="margin-bottom:0.3rem;">${job.title}</h3>
                                <span class="news-date">üìç ${job.location}, ${job.country} ‚Ä¢ ${job.experience}</span>
                            </div>
                        </div>
                        <br>
                        <button class="btn btn-primary read-btn" data-job="${index}">Know More</button>
                    `;
                    return jobElement;
                });
                
                // Append all elements at once
                jobsContainer.append(...jobElements);
                
                // Update jobsListings array for modal functionality
                window.jobsListings = jobs;
                
                // Attach event listeners
                attachJobModalListeners();
            } catch (error) {
                console.error('Error in loadJobListings:', error);
            }
        }
        
        // Attach job modal event listeners
        function attachJobModalListeners() {
            document.querySelectorAll('.read-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const jobIndex = this.getAttribute('data-job');
                    const job = window.jobsListings[jobIndex];
                    if (job) {
                        showJobModal(job);
                    }
                });
            });
        }
        
        // Show job modal
        function showJobModal(job) {
            const modal = document.getElementById('jobModal');
            const modalContent = document.getElementById('modalContent');
            
            modalContent.innerHTML = `
                <div style="position:relative;">
                    <button onclick="closeModal()" style="position:absolute;top:0;right:0;background:none;border:none;font-size:2rem;cursor:pointer;color:var(--text-primary);">&times;</button>
                    <h2 style="margin-bottom:1rem;color:var(--text-primary);">${job.title}</h2>
                    <p style="color:var(--text-secondary);margin-bottom:1.5rem;font-size:0.9rem;">
                        üìç ${job.location}, ${job.country} ‚Ä¢ ${job.type} ‚Ä¢ ${job.experience}
                    </p>
                    
                    <div style="color:var(--text-primary);line-height:1.6;">
                        <h3 style="margin-bottom:1rem;color:var(--primary-green);">About the Role</h3>
                        <p style="margin-bottom:1.5rem;">${job.description}</p>
                        
                        <h3 style="margin-bottom:1rem;color:var(--primary-green);">Requirements</h3>
                        <ul style="margin-bottom:1.5rem;">
                            ${job.requirements.map(req => `<li style="margin-bottom:0.5rem;">${req}</li>`).join('')}
                        </ul>
                        
                        <h3 style="margin-bottom:1rem;color:var(--primary-green);">Responsibilities</h3>
                        <ul style="margin-bottom:1.5rem;">
                            ${job.responsibilities.map(resp => `<li style="margin-bottom:0.5rem;">${resp}</li>`).join('')}
                        </ul>
                        
                        <div style="text-align:center;margin-top:2rem;">
                            <button onclick="showApplicationForm('${job.title}')" class="btn btn-primary" style="text-decoration:none;display:inline-block;">
                                Apply for this Position
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
        }
        
        // Show application form
        function showApplicationForm(jobTitle) {
            const modalContent = document.getElementById('modalContent');
            
            // Store current job title globally
            window.currentJobTitle = jobTitle;
            
            modalContent.innerHTML = `
                <div style="position:relative;">
                    <button onclick="closeModal()" style="position:absolute;top:0;right:0;background:none;border:none;font-size:2rem;cursor:pointer;color:var(--text-primary);">&times;</button>
                    <h2 style="margin-bottom:1rem;color:var(--text-primary);">Apply for ${jobTitle}</h2>
                    
                    <form id="jobApplicationForm" style="margin-top:2rem;">
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem;">
                            <div>
                                <label style="display:block;margin-bottom:0.5rem;color:var(--text-primary);font-weight:500;">First Name *</label>
                                <input type="text" name="firstName" required style="width:100%;padding:0.75rem;border:1px solid var(--border-color);border-radius:8px;background:#fff;color:#333;">
                            </div>
                            <div>
                                <label style="display:block;margin-bottom:0.5rem;color:var(--text-primary);font-weight:500;">Last Name *</label>
                                <input type="text" name="lastName" required style="width:100%;padding:0.75rem;border:1px solid var(--border-color);border-radius:8px;background:#fff;color:#333;">
                            </div>
                        </div>
                        
                        <div style="margin-bottom:1rem;">
                            <label style="display:block;margin-bottom:0.5rem;color:var(--text-primary);font-weight:500;">Email *</label>
                            <input type="email" name="email" required style="width:100%;padding:0.75rem;border:1px solid var(--border-color);border-radius:8px;background:#fff;color:#333;">
                        </div>
                        
                        <div style="margin-bottom:1rem;">
                            <label style="display:block;margin-bottom:0.5rem;color:var(--text-primary);font-weight:500;">Phone Number</label>
                            <input type="tel" name="phone" style="width:100%;padding:0.75rem;border:1px solid var(--border-color);border-radius:8px;background:#fff;color:#333;">
                        </div>
                        
                        <div style="margin-bottom:1rem;">
                            <label style="display:block;margin-bottom:0.5rem;color:var(--text-primary);font-weight:500;">Current Location</label>
                            <input type="text" name="location" placeholder="City, State/Province" style="width:100%;padding:0.75rem;border:1px solid var(--border-color);border-radius:8px;background:#fff;color:#333;">
                        </div>
                        
                        <div style="margin-bottom:1rem;">
                            <label style="display:block;margin-bottom:0.5rem;color:var(--text-primary);font-weight:500;">Years of Experience</label>
                            <select name="experience" style="width:100%;padding:0.75rem;border:1px solid var(--border-color);border-radius:8px;background:#fff;color:#333;">
                                <option value="">Select experience level</option>
                                <option value="0-1">0-1 years</option>
                                <option value="1-3">1-3 years</option>
                                <option value="3-5">3-5 years</option>
                                <option value="5-10">5-10 years</option>
                                <option value="10+">10+ years</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom:1rem;">
                            <label style="display:block;margin-bottom:0.5rem;color:var(--text-primary);font-weight:500;">Resume/CV *</label>
                            <input type="file" name="resume" accept=".pdf,.doc,.docx" required style="width:100%;padding:0.75rem;border:1px solid var(--border-color);border-radius:8px;background:#fff;color:#333;">
                            <small style="color:var(--text-secondary);font-size:0.8rem;">Accepted formats: PDF, DOC, DOCX (Max 5MB)</small>
                        </div>
                        
                        <div style="margin-bottom:1rem;">
                            <label style="display:block;margin-bottom:0.5rem;color:var(--text-primary);font-weight:500;">Cover Letter</label>
                            <textarea name="coverLetter" rows="4" placeholder="Tell us why you're interested in this position..." style="width:100%;padding:0.75rem;border:1px solid var(--border-color);border-radius:8px;background:#fff;color:#333;resize:vertical;"></textarea>
                        </div>
                        
                        <div style="margin-bottom:1rem;">
                            <label style="display:block;margin-bottom:0.5rem;color:var(--text-primary);font-weight:500;">How did you hear about us?</label>
                            <select name="source" style="width:100%;padding:0.75rem;border:1px solid var(--border-color);border-radius:8px;background:#fff;color:#333;">
                                <option value="">Select an option</option>
                                <option value="website">Company Website</option>
                                <option value="linkedin">LinkedIn</option>
                                <option value="indeed">Indeed</option>
                                <option value="referral">Employee Referral</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div style="display:flex;gap:1rem;margin-top:2rem;">
                            <button type="button" onclick="goBackToJobDetails()" class="btn btn-secondary" style="flex:1;">Back to Job Details</button>
                            <button type="submit" class="btn btn-primary" style="flex:1;">Submit Application</button>
                        </div>
                    </form>
                </div>
            `;
            
            // Add form submission handler
            document.getElementById('jobApplicationForm').addEventListener('submit', handleApplicationSubmit);
        }
        
        // Handle application form submission
        function handleApplicationSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const applicationData = {
                jobTitle: window.currentJobTitle || 'Unknown Position',
                firstName: formData.get('firstName'),
                lastName: formData.get('lastName'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                location: formData.get('location'),
                experience: formData.get('experience'),
                coverLetter: formData.get('coverLetter'),
                source: formData.get('source'),
                resume: formData.get('resume')
            };
            
            // Show loading state
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Submitting...';
            submitBtn.disabled = true;
            
            // Send application via email using EmailJS
            sendApplicationEmail(applicationData)
                .then(() => {
                    // Show success message
                    const modalContent = document.getElementById('modalContent');
                    modalContent.innerHTML = `
                        <div style="position:relative;text-align:center;">
                            <button onclick="closeModal()" style="position:absolute;top:0;right:0;background:none;border:none;font-size:2rem;cursor:pointer;color:var(--text-primary);">&times;</button>
                            <div style="margin-top:2rem;">
                                <i class="fas fa-check-circle" style="font-size:3rem;color:var(--primary-green);margin-bottom:1rem;"></i>
                                <h2 style="color:var(--text-primary);margin-bottom:1rem;">Application Submitted!</h2>
                                <p style="color:var(--text-secondary);margin-bottom:1rem;">Thank you for your interest in joining our team. We've received your application and will review it carefully.</p>
                                <p style="color:var(--text-secondary);font-size:0.9rem;">We'll contact you within 5-7 business days if your profile matches our requirements.</p>
                                <button onclick="closeModal()" class="btn btn-primary" style="margin-top:2rem;">Close</button>
                            </div>
                        </div>
                    `;
                })
                .catch((error) => {
                    console.error('EmailJS Error:', error);
                    console.error('Error details:', {
                        status: error.status,
                        text: error.text,
                        response: error.response
                    });
                    // Show error message
                    const modalContent = document.getElementById('modalContent');
                    modalContent.innerHTML = `
                        <div style="position:relative;text-align:center;">
                            <button onclick="closeModal()" style="position:absolute;top:0;right:0;background:none;border:none;font-size:2rem;cursor:pointer;color:var(--text-primary);">&times;</button>
                            <div style="margin-top:2rem;">
                                <i class="fas fa-exclamation-circle" style="font-size:3rem;color:#ff6b6b;margin-bottom:1rem;"></i>
                                <h2 style="color:var(--text-primary);margin-bottom:1rem;">Submission Error</h2>
                                <p style="color:var(--text-secondary);margin-bottom:1rem;">We encountered an issue submitting your application. Please try again or contact us directly.</p>
                                <p style="color:var(--text-secondary);font-size:0.8rem;margin-top:1rem;">Error: ${error.text || error.status || 'Unknown error'}</p>
                                <button onclick="closeModal()" class="btn btn-primary" style="margin-top:2rem;">Close</button>
                            </div>
                        </div>
                    `;
                })
                .finally(() => {
                    // Reset button
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                });
        }
        
        // Function to send application email using EmailJS
        function sendApplicationEmail(applicationData) {
            // EmailJS template parameters
            const templateParams = {
                job_title: applicationData.jobTitle,
                applicant_name: `${applicationData.firstName} ${applicationData.lastName}`,
                applicant_email: applicationData.email,
                applicant_phone: applicationData.phone || 'Not provided',
                applicant_location: applicationData.location || 'Not provided',
                applicant_experience: applicationData.experience || 'Not specified',
                cover_letter: applicationData.coverLetter || 'No cover letter provided',
                source: applicationData.source || 'Not specified',
                resume_filename: applicationData.resume ? applicationData.resume.name : 'No resume uploaded'
            };
            
            console.log('Sending email with params:', templateParams);
            
            // If there's a resume file, upload to Supabase and send with link
            if (applicationData.resume && applicationData.resume.size > 0) {
                console.log('Resume file detected, uploading to Supabase...');
                return sendEmailWithAttachment(applicationData, templateParams);
            } else {
                // Send email without attachment
                console.log('No resume file, sending email without attachment');
                return emailjs.send(
                    'service_m6detwu', // Your EmailJS service ID
                    'template_ig76fyd', // Your EmailJS template ID
                    templateParams
                );
            }
        }
        
        // Upload resume to Supabase Storage and send email with link
        async function sendEmailWithAttachment(applicationData, templateParams) {
            try {
                console.log('Starting resume upload process...');
                console.log('Resume file:', applicationData.resume);
                console.log('File size:', applicationData.resume.size, 'bytes');
                
                // Check if Supabase is properly initialized
                if (!supabase) {
                    console.error('Supabase not initialized');
                    throw new Error('Supabase not available');
                }
                
                // Upload resume to Supabase Storage
                const fileName = `resumes/${Date.now()}_${applicationData.resume.name}`;
                console.log('Uploading to:', fileName);
                
                const { data: uploadData, error: uploadError } = await supabase.storage
                    .from('job-applications')
                    .upload(fileName, applicationData.resume);
                
                if (uploadError) {
                    console.error('Upload error details:', uploadError);
                    throw new Error(`Failed to upload resume: ${uploadError.message}`);
                }
                
                console.log('Resume uploaded successfully:', fileName);
                console.log('Upload data:', uploadData);
                
                // Get public URL for the uploaded file
                const { data: { publicUrl } } = supabase.storage
                    .from('job-applications')
                    .getPublicUrl(fileName);
                
                console.log('Generated public URL:', publicUrl);
                
                // Add resume link to template params
                templateParams.resume_url = publicUrl;
                templateParams.resume_filename = applicationData.resume.name;
                
                console.log('Updated template params:', templateParams);
                
                // Send email with resume link
                const emailResult = await emailjs.send(
                    'service_m6detwu',
                    'template_ig76fyd',
                    templateParams
                );
                
                console.log('Email sent successfully with resume link');
                return emailResult;
                
            } catch (error) {
                console.error('Error in sendEmailWithAttachment:', error);
                console.error('Error details:', {
                    message: error.message,
                    stack: error.stack
                });
                
                // Fallback to sending without resume link
                console.log('Falling back to sending without resume link');
                templateParams.resume_url = 'No resume uploaded';
                templateParams.resume_filename = 'No resume uploaded';
                
                return emailjs.send(
                    'service_m6detwu',
                    'template_ig76fyd',
                    templateParams
                );
            }
        }
        
        // Go back to job details
        function goBackToJobDetails() {
            // This would need to be implemented to show the job details again
            // For simplicity, we'll close the modal and reopen it
            closeModal();
            // You could store the current job data and show it again
        }
        
        // Close modal
        function closeModal() {
            document.getElementById('jobModal').style.display = 'none';
        }
        
        // Close modal when clicking outside
        document.getElementById('jobModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        
        // Load jobs when page loads and setup mobile menu
        document.addEventListener('DOMContentLoaded', function() {
            loadJobListings();
            
            // Mobile menu toggle
            const navToggle = document.querySelector('.nav-toggle');
            const navMenu = document.querySelector('.nav-menu');
            

            

            
            // Mobile menu is handled by script.js
            console.log('Mobile menu setup complete - handled by script.js');
        });
        
        // Job filter logic
        const jobFilterBtns = document.querySelectorAll('#jobFilters .filter-btn');
        
        jobFilterBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                jobFilterBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                const filter = this.getAttribute('data-filter');
                
                const jobPostsGridItems = document.querySelectorAll('.job-post');
                jobPostsGridItems.forEach(post => {
                    if (filter === 'all' || post.getAttribute('data-type') === filter) {
                        post.style.display = 'block';
                    } else {
                        post.style.display = 'none';
                    }
                });
            });
        });
    </script>
</body>
</html> 